# Textile Marketplace - Mermaid Diagrams

## 1. System Architecture Diagram

```mermaid
graph TB
    subgraph "Frontend (React + Vite)"
        A[User Browser] --> B[React App]
        B --> C[Pages]
        B --> D[Components]
        B --> E[Context/Auth]
        B --> F[Hooks]
        B --> G[Utils/API]
        C --> C1[Home]
        C --> C2[Login/Register]
        C --> C3[Vendor Pages]
        C --> C4[Admin Pages]
        C3 --> C31[Dashboard]
        C3 --> C32[MyProducts]
        C3 --> C33[NewProduct]
        C3 --> C34[Profile]
        C4 --> C41[AdminDashboard]
        C4 --> C42[ProductsReview]
        C4 --> C43[VendorsManage]
        C4 --> C44[CategoriesManage]
    end

    subgraph "Backend (Node.js + Express)"
        H[Express Server] --> I[Routes]
        I --> I1[/api/auth]
        I --> I2[/api/vendors]
        I --> I3[/api/products]
        I --> I4[/api/admin]
        I --> I5[/api/categories]
        I --> I6[/api/upload]
        I1 --> J1[AuthController]
        I2 --> J2[VendorController]
        I3 --> J3[ProductController]
        I4 --> J4[AdminController]
        I5 --> J5[CategoryController]
        I6 --> J6[Upload Middleware]
        J1 --> K[Middleware]
        J2 --> K
        J3 --> K
        J4 --> K
        J5 --> K
        K --> K1[Auth Middleware]
        K --> K2[Error Handler]
        K --> K3[Upload Handler]
        J1 --> L[Models]
        J2 --> L
        J3 --> L
        J4 --> L
        J5 --> L
    end

    subgraph "Database (SQLite)"
        L --> M[(Sequelize ORM)]
        M --> N[(Vendors Table)]
        M --> O[(Products Table)]
        M --> P[(Categories Table)]
        M --> Q[(ProductImages Table)]
        M --> R[(Admin Table)]
    end

    G -->|HTTP/REST API| H
    A -->|Static Files| B
    H -->|Static Files| S[Uploads Directory]
```

## 2. Database Entity Relationship Diagram

```mermaid
erDiagram
    VENDOR ||--o{ PRODUCT : creates
    CATEGORY ||--o{ PRODUCT : categorizes
    PRODUCT ||--o{ PRODUCT_IMAGE : has
    
    VENDOR {
        int id PK
        string business_name
        string email UK
        string password_hash
        string phone
        enum status
        datetime createdAt
        datetime updatedAt
    }
    
    PRODUCT {
        int id PK
        int vendor_id FK
        string title
        text description
        float price
        enum status
        int category_id FK
        datetime createdAt
        datetime updatedAt
    }
    
    CATEGORY {
        int id PK
        string name UK
        string description
        datetime createdAt
        datetime updatedAt
    }
    
    PRODUCT_IMAGE {
        int id PK
        int product_id FK
        string image_url
        boolean is_primary
        datetime createdAt
        datetime updatedAt
    }
    
    ADMIN {
        int id PK
        string username UK
        string email
        string password_hash
        enum role
        datetime createdAt
        datetime updatedAt
    }
```

## 3. Frontend Component Structure

```mermaid
graph TD
    A[main.jsx] --> B[App.jsx]
    B --> C[AuthContext Provider]
    C --> D[Routes]
    
    D --> E[Public Routes]
    D --> F[Protected Vendor Routes]
    D --> G[Protected Admin Routes]
    
    E --> E1[Home Page]
    E --> E2[Login Page]
    E --> E3[Register Page]
    
    F --> F1[VendorDashboard]
    F --> F2[MyProducts]
    F --> F3[NewProduct]
    F --> F4[Profile]
    
    G --> G1[AdminDashboard]
    G --> G2[ProductsReview]
    G --> G3[VendorsManage]
    G --> G4[CategoriesManage]
    
    H[Common Components] --> H1[Header]
    H --> H2[ProtectedRoute]
    
    I[Hooks] --> I1[useAuth]
    I --> I2[useProducts]
    I --> I3[useVendors]
    
    J[Utils] --> J1[api.js]
    J --> J2[constants.js]
    
    E1 --> I
    E2 --> I1
    E3 --> I1
    F1 --> I
    F2 --> I2
    F3 --> I2
    G1 --> I
    G2 --> I2
    G3 --> I3
    
    I1 --> J1
    I2 --> J1
    I3 --> J1
    J1 --> J2
```

## 4. API Routes and Flow

```mermaid
graph LR
    subgraph "Authentication Routes"
        A1[POST /api/auth/vendor/register] --> A2[registerVendor]
        A3[POST /api/auth/vendor/login] --> A4[loginVendor]
        A5[POST /api/auth/admin/login] --> A6[loginAdmin]
    end
    
    subgraph "Vendor Routes"
        B1[GET /api/vendors] --> B2[listVendors]
        B3[GET /api/vendors/:id] --> B4[getVendor]
        B5[PUT /api/vendors/:id] --> B6[updateVendor]
    end
    
    subgraph "Product Routes"
        C1[POST /api/products] --> C2[createProduct]
        C3[GET /api/products/mine] --> C4[listVendorProducts]
        C5[GET /api/products] --> C6[listProductsAdmin]
        C7[PUT /api/products/:id/status] --> C8[updateStatusAdmin]
    end
    
    subgraph "Admin Routes"
        D1[GET /api/admin/stats] --> D2[getStats]
        D3[PUT /api/admin/vendors/:id/status] --> D4[updateVendorStatus]
    end
    
    subgraph "Category Routes"
        E1[GET /api/categories] --> E2[listCategories]
        E2 --> E3[createCategory - Admin]
        E4[PUT /api/categories/:id] --> E5[updateCategory - Admin]
        E6[DELETE /api/categories/:id] --> E7[deleteCategory - Admin]
    end
    
    subgraph "Upload Routes"
        F1[POST /api/upload] --> F2[uploadFile]
    end
    
    A2 --> G[Auth Middleware]
    A4 --> G
    A6 --> G
    B2 --> G
    B4 --> G
    B6 --> G
    C2 --> G
    C4 --> G
    C6 --> G
    C8 --> G
    D2 --> G
    D4 --> G
    E3 --> G
    E5 --> G
    E7 --> G
    F2 --> G
    
    G --> H[Database Models]
```

## 5. Authentication Flow

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant A as Auth API
    participant DB as Database
    participant M as Middleware
    
    Note over U,DB: Registration Flow
    U->>F: Fill Registration Form
    F->>A: POST /api/auth/vendor/register
    A->>DB: Check if email exists
    DB-->>A: Email check result
    A->>DB: Create vendor (hash password)
    DB-->>A: Vendor created
    A-->>F: Success response
    F-->>U: Registration successful
    
    Note over U,DB: Login Flow
    U->>F: Enter credentials
    F->>A: POST /api/auth/vendor/login
    A->>DB: Find vendor by email
    DB-->>A: Vendor data
    A->>A: Verify password
    A->>A: Generate JWT token
    A-->>F: Return token + user data
    F->>F: Store token in localStorage
    F->>F: Update AuthContext
    F-->>U: Redirect to dashboard
    
    Note over U,DB: Protected Route Access
    U->>F: Navigate to protected route
    F->>F: Check localStorage for token
    F->>A: API request with Authorization header
    A->>M: Validate JWT token
    M->>M: Check user role
    M-->>A: Token valid
    A->>DB: Fetch data
    DB-->>A: Return data
    A-->>F: Return response
    F-->>U: Display data
```

## 6. Product Management Flow

```mermaid
flowchart TD
    A[Vendor Logs In] --> B[Vendor Dashboard]
    B --> C{Action}
    
    C -->|Create Product| D[New Product Form]
    C -->|View Products| E[My Products Page]
    C -->|Update Profile| F[Profile Page]
    
    D --> G[Fill Product Details]
    G --> H[Upload Images]
    H --> I[Submit Form]
    I --> J[POST /api/products]
    J --> K[Auth Middleware]
    K --> L[Upload Middleware]
    L --> M[Create Product in DB]
    M --> N[Save Product Images]
    N --> O[Status: pending]
    O --> P[Return Product Data]
    P --> Q[Display Success Message]
    
    E --> R[GET /api/products/mine]
    R --> S[Auth Middleware]
    S --> T[Fetch Vendor Products]
    T --> U[Display Products List]
    
    V[Admin Logs In] --> W[Admin Dashboard]
    W --> X[Products Review Page]
    X --> Y[GET /api/products]
    Y --> Z[Auth Middleware - Admin]
    Z --> AA[Fetch All Products]
    AA --> AB[Display Products with Status]
    AB --> AC{Admin Action}
    AC -->|Approve| AD[PUT /api/products/:id/status]
    AC -->|Reject| AD
    AD --> AE[Update Product Status]
    AE --> AF[Notify Vendor]
```

## 7. Technology Stack

```mermaid
graph TB
    subgraph "Frontend Stack"
        F1[React 18.2.0]
        F2[React Router DOM 6.26.2]
        F3[Vite 5.4.8]
        F4[Tailwind CSS 3.4.14]
        F5[Axios 1.6.8]
        F6[React Hook Form 7.51.4]
    end
    
    subgraph "Backend Stack"
        B1[Express 5.1.0]
        B2[Sequelize 6.37.7]
        B3[SQLite3 5.1.7]
        B4[JSON Web Token 9.0.2]
        B5[Bcryptjs 3.0.3]
        B6[Multer 2.0.2]
        B7[Helmet 8.1.0]
        B8[CORS 2.8.5]
        B9[Express Rate Limit 8.2.1]
    end
    
    subgraph "Development Tools"
        D1[Nodemon 3.1.11]
        D2[PostCSS 8.4.49]
        D3[Autoprefixer 10.4.20]
    end
```

## 8. User Roles and Permissions

```mermaid
graph TD
    A[User] --> B{User Type}
    
    B -->|Public| C[Public Access]
    C --> C1[View Home Page]
    C --> C2[Login]
    C --> C3[Register as Vendor]
    C --> C4[View Categories]
    
    B -->|Vendor| D[Vendor Access]
    D --> D1[Vendor Dashboard]
    D --> D2[Create Products]
    D --> D3[View Own Products]
    D --> D4[Update Profile]
    D --> D5[Upload Product Images]
    
    B -->|Admin| E[Admin Access]
    E --> E1[Admin Dashboard]
    E --> E2[Review Products]
    E --> E3[Approve/Reject Products]
    E --> E4[Manage Vendors]
    E --> E5[Manage Categories]
    E --> E6[View Statistics]
    E --> E7[Suspend/Activate Vendors]
    
    D1 --> F[Protected Route]
    D2 --> F
    D3 --> F
    D4 --> F
    E1 --> G[Protected Route - Admin]
    E2 --> G
    E3 --> G
    E4 --> G
    E5 --> G
    E6 --> G
    E7 --> G
    
    F --> H[Auth Middleware - Vendor]
    G --> I[Auth Middleware - Admin]
```
